<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D Print Price Calculator</title>
  <meta name="theme-color" content="#111827" />
  <style>
    :root { --bg:#0b1220; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --line:#1f2937; --accent:#22c55e; }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(1200px 800px at 10% 10%, #0f1a33 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{ max-width:980px; margin:0 auto; padding:18px; }
    h1{ font-size:20px; margin:6px 0 2px; }
    p.sub{ margin:0 0 16px; color:var(--muted); font-size:13px; }
    .grid{ display:grid; grid-template-columns: 1.05fr .95fr; gap:14px; }
    @media (max-width: 860px){ .grid{ grid-template-columns:1fr; } }
    .card{
      background: rgba(17,24,39,.9);
      border:1px solid var(--line);
      border-radius:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      padding:14px;
    }
    .sec-title{ display:flex; justify-content:space-between; align-items:baseline; margin:0 0 8px; }
    .sec-title h2{ font-size:14px; margin:0; }
    .sec-title span{ color:var(--muted); font-size:12px; }
    .fields{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width: 520px){ .fields{ grid-template-columns:1fr; } }
    label{ display:block; font-size:12px; color:var(--muted); margin:0 0 6px; }
    input{
      width:100%; padding:10px 10px;
      border-radius:10px; border:1px solid var(--line);
      background:#0b1020; color:var(--text);
      outline:none;
    }
    input:focus{ border-color:#334155; box-shadow: 0 0 0 3px rgba(34,197,94,.12); }
    input::placeholder{ color: rgba(156,163,175,.7); }
    .btns{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
    button{
      border:0; border-radius:12px; padding:10px 12px; cursor:pointer; font-weight:600;
      background:var(--accent); color:#08210f;
    }
    button.secondary{ background:#0b1020; color:var(--text); border:1px solid var(--line); }
    .note{ color:var(--muted); font-size:12px; margin-top:8px; line-height:1.35; }
    .breakdown{ margin-top:8px; border-top:1px dashed var(--line); padding-top:10px; }
    .line-item{ display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid rgba(31,41,55,.5); }
    .line-item:last-child{ border-bottom:0; }
    .k{ color:var(--muted); font-size:13px; }
    .v{ font-variant-numeric: tabular-nums; }
    .total{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:10px; padding:10px 12px; border-radius:12px;
      background: rgba(34,197,94,.10); border:1px solid rgba(34,197,94,.35);
    }
    .total .k{ color:#bbf7d0; }
    .total .v{ font-size:18px; font-weight:800; }
    .tiny{ font-size:11px; color:var(--muted); margin-top:8px; }
    .pill{
      display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border-radius:999px;
      background:#0b1020; border:1px solid var(--line); color:var(--muted); font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>3D Print Price Calculator</h1>
    <p class="sub">Single-file version. No preset numbers — you type your values.</p>

    <div class="grid">
      <!-- INPUTS -->
      <div class="card">
        <div class="sec-title">
          <h2>Inputs</h2>
          <span class="pill">Updates as you type</span>
        </div>

        <div class="fields">
          <div>
            <label>Print time (hours)</label>
            <input id="printHours" type="number" min="0" step="0.01" placeholder="e.g., 6" />
          </div>

          <div>
            <label>Filament used (grams)</label>
            <input id="gramsUsed" type="number" min="0" step="1" placeholder="e.g., 100" />
          </div>

          <div>
            <label>Spool price ($)</label>
            <input id="spoolPrice" type="number" min="0" step="0.01" placeholder="e.g., 20" />
          </div>

          <div>
            <label>Spool weight (grams)</label>
            <input id="spoolWeight" type="number" min="1" step="1" placeholder="e.g., 1000" />
          </div>

          <div>
            <label>Waste factor (%)</label>
            <input id="wastePct" type="number" min="0" step="0.1" placeholder="e.g., 5" />
          </div>

          <div>
            <label>Power draw (kW)</label>
            <input id="powerKW" type="number" min="0" step="0.001" placeholder="e.g., 0.115" />
          </div>

          <div>
            <label>Electricity rate ($/kWh)</label>
            <input id="elecRate" type="number" min="0" step="0.001" placeholder="e.g., 0.146" />
          </div>

          <div>
            <label>Labor rate ($/hr)</label>
            <input id="laborRate" type="number" min="0" step="0.01" placeholder="e.g., 40" />
          </div>

          <div>
            <label>Active labor (minutes)</label>
            <input id="laborMin" type="number" min="0" step="1" placeholder="e.g., 35" />
          </div>

          <div>
            <label>Overhead (%)</label>
            <input id="overheadPct" type="number" min="0" step="0.1" placeholder="e.g., 10" />
          </div>

          <div>
            <label>Profit margin (%)</label>
            <input id="profitPct" type="number" min="0" step="0.1" placeholder="e.g., 15" />
          </div>

          <div>
            <label>Minimum job fee ($)</label>
            <input id="minFee" type="number" min="0" step="0.01" placeholder="e.g., 25" />
          </div>
        </div>

        <div class="btns">
          <button id="resetBtn" class="secondary" type="button">Reset (clear all)</button>
          <button id="copyBtn" class="secondary" type="button">Copy quote</button>
        </div>

        <div class="note">
          Next upgrades: printer/filament presets (with NO forced numbers), depreciation, saved profiles.
        </div>
      </div>

      <!-- OUTPUTS -->
      <div class="card">
        <div class="sec-title">
          <h2>Estimate</h2>
          <span id="status" class="tiny">Enter values to calculate</span>
        </div>

        <div class="breakdown" id="breakdown"></div>

        <div class="total">
          <div class="k">Final Price</div>
          <div class="v" id="finalPrice">$0.00</div>
        </div>

        <div class="tiny">
          Formula: base = material + electricity + labor. Then add overhead and profit. Final is max(final, minimum fee).
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const inputIds = [
      "printHours","gramsUsed","spoolPrice","spoolWeight","wastePct",
      "powerKW","elecRate","laborRate","laborMin","overheadPct","profitPct","minFee"
    ];

    function money(n){
      const v = Number.isFinite(n) ? n : 0;
      return v.toLocaleString(undefined, { style:"currency", currency:"USD" });
    }

    // Empty input should count as 0 (instead of NaN)
    function num(id){
      const raw = $(id).value;
      if (raw === "" || raw === null || raw === undefined) return 0;
      const v = parseFloat(raw);
      return Number.isFinite(v) ? v : 0;
    }

    function renderEmpty(){
      $("breakdown").innerHTML = `
        <div class="line-item"><div class="k">Material (incl. waste)</div><div class="v">$0.00</div></div>
        <div class="line-item"><div class="k">Electricity</div><div class="v">$0.00</div></div>
        <div class="line-item"><div class="k">Active labor</div><div class="v">$0.00</div></div>
        <div class="line-item"><div class="k">Base subtotal</div><div class="v">$0.00</div></div>
        <div class="line-item"><div class="k">Overhead</div><div class="v">$0.00</div></div>
        <div class="line-item"><div class="k">Profit</div><div class="v">$0.00</div></div>
        <div class="line-item"><div class="k">Minimum fee applied?</div><div class="v">No</div></div>
      `;
      $("finalPrice").textContent = "$0.00";
      $("status").textContent = "Enter values to calculate";
    }

    function calc(){
      const printHours = num("printHours");
      const gramsUsed = num("gramsUsed");
      const spoolPrice = num("spoolPrice");
      const spoolWeight = Math.max(1, num("spoolWeight")); // avoid divide by 0
      const wastePct = num("wastePct") / 100;

      const powerKW = num("powerKW");
      const elecRate = num("elecRate");

      const laborRate = num("laborRate");
      const laborMin = num("laborMin");

      const overheadPct = num("overheadPct") / 100;
      const profitPct = num("profitPct") / 100;
      const minFee = num("minFee");

      // Detect if user entered anything at all
      const anyInput = inputIds.some(id => $(id).value !== "");
      if (!anyInput){
        renderEmpty();
        return null;
      }

      // Material
      const costPerGram = spoolPrice / spoolWeight;
      const effectiveGrams = gramsUsed * (1 + Math.max(0, wastePct));
      const materialCost = effectiveGrams * costPerGram;

      // Electricity
      const electricityCost = printHours * powerKW * elecRate;

      // Labor (active time only)
      const laborHours = laborMin / 60;
      const laborCost = laborHours * laborRate;

      // Base
      const base = materialCost + electricityCost + laborCost;

      // Overhead added on base
      const overheadCost = base * Math.max(0, overheadPct);

      // Profit added on (base + overhead)
      const subtotal = base + overheadCost;
      const profit = subtotal * Math.max(0, profitPct);

      // Final
      const rawFinal = subtotal + profit;
      const final = Math.max(rawFinal, Math.max(0, minFee));

      const breakdown = [
        ["Material (incl. waste)", materialCost],
        ["Electricity", electricityCost],
        ["Active labor", laborCost],
        ["Base subtotal", base],
        ["Overhead", overheadCost],
        ["Profit", profit],
        ["Minimum fee applied?", final > rawFinal ? 1 : 0]
      ];

      $("breakdown").innerHTML = breakdown.map(([k,v]) => {
        const val = (k === "Minimum fee applied?") ? (v ? "Yes" : "No") : money(v);
        return `<div class="line-item"><div class="k">${k}</div><div class="v">${val}</div></div>`;
      }).join("");

      $("finalPrice").textContent = money(final);
      $("status").textContent = "Updated";
      return {
        printHours, gramsUsed, effectiveGrams, spoolPrice, spoolWeight, wastePct,
        powerKW, elecRate, laborRate, laborMin,
        overheadPct, profitPct, minFee,
        materialCost, electricityCost, laborCost, overheadCost, profit, final
      };
    }

    // Auto-calc on input changes
    inputIds.forEach(id => $(id).addEventListener("input", calc));

    // Reset (clear all inputs)
    $("resetBtn").addEventListener("click", () => {
      inputIds.forEach(id => $(id).value = "");
      renderEmpty();
    });

    $("copyBtn").addEventListener("click", async () => {
      const r = calc();
      if (!r){
        alert("Enter some values first, then try copying the quote.");
        return;
      }
      const text =
`3D Print Quote
- Print time: ${r.printHours} hr
- Filament: ${r.gramsUsed} g (+ waste = ${r.effectiveGrams.toFixed(1)} g)
- Material cost: ${money(r.materialCost)}
- Electricity cost: ${money(r.electricityCost)}
- Active labor: ${r.laborMin} min @ ${money(r.laborRate)}/hr = ${money(r.laborCost)}
- Overhead: ${Math.round(r.overheadPct*1000)/10}% = ${money(r.overheadCost)}
- Profit: ${Math.round(r.profitPct*1000)/10}% = ${money(r.profit)}
- Minimum fee: ${money(r.minFee)}
= Final: ${money(r.final)}`;
      try{
        await navigator.clipboard.writeText(text);
        $("status").textContent = "Copied to clipboard ✅";
      }catch(e){
        $("status").textContent = "Copy failed (browser blocked clipboard)";
        alert(text);
      }
    });

    // Init
    renderEmpty();
  </script>
</body>
</html>
